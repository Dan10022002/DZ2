#include <iostream>
#include <string>
#include <vector>
#include <ctype.h>
#include <stack>
#include <cmath>

char Priority_stack(std::stack<char>& sings)
{
    switch (sings.top())
    {
    case '+':
    case '-':
    {
        return 1;
    }
    case '*':
    case '/':
    {
        return 2;
    }
    case '^':
    {
        return 3;
    }
    }
}

char Priority(char& simvol)
{
    switch (simvol)
    {
    case '+':
    case '-':
    {
        return 1;
    }
    case '*':
    case '/':
    {
        return 2;
    }
    case '^':
    {
        return 3;
    }
    }
}

void Number_add(std::vector <double>& exit, std::vector <char>& number)
{
    char index = 0;
    for (char h : number)
    {
        if (number[h] == '.')
        {
            index = h;
        }
    }
    double add_number = 0;
    for (char h : number)
    {
        if (h < index)
        {
            add_number += number[h] * pow(10, ((index - h) - 1));
        }
        if (h > index)
        {
            add_number += number[h] * pow(10, (index - h));
        }
    }
    exit.push_back(add_number);
}

void Function_add(std::string& function, std::vector <double>& exit, std::stack<char>& signs)
{
    if (function == "x")
    {
        std::cout << "Enter the x argument: ";
        double x;
        std::cin >> x;
        exit.push_back(x);
    }
    else if (function == "pi")
    {
        exit.push_back('p');
    }
    else if (function == "e")
    {
        exit.push_back('e');
    }
    else if (function == "sin")
    {
        signs.push('s');
    }
    else if (function == "tg")
    {
        signs.push('T');
    }
    else if (function == "cos")
    {
        signs.push('c');
    }
    else if (function == "ctg")
    {
        signs.push('C'); // отличается регистром с косинусом, чтобы однозначно определить потом для калькулятора
    }
    else if (function == "sqrt")
    {
        signs.push('S'); // отличается регистром с синусом, чтобы однозначно определить потом для калькулятора
    }
    else if (function == "exp")
    {
        exit.push_back('e');
        signs.push('^');
    }
    function.clear();
}

void Exit(std::vector <double>& exit, std::stack<char>& signs,std::string& function, std::vector <char>& number, char simvol)
{
    if (isdigit(simvol) != 0) 
    {
        number.push_back(simvol);
    }
    else
    {
        if (isalpha(simvol) != 0)
        {
            function += simvol;
        }
        else
        {
            if (simvol == '.')
            {
                number.push_back(simvol);
            }
            else
            {
                Number_add(exit, number);
                Function_add(function, exit, signs);
                if (signs.size() == 0)
                {
                    signs.push(simvol);
                }
                else if (Priority(simvol) > Priority_stack(signs))
                {
                    signs.push(simvol);
                }
                else if (simvol == '(')
                {
                    signs.push(simvol);
                }
                else if (signs.top() == '(')
                {
                    signs.push(simvol);
                }
                else if (simvol == ')')
                {
                    while (signs.top() != '(')
                    {
                        exit.push_back(signs.top());
                        signs.pop();
                    }
                    signs.pop();
                }
                else
                {
                    exit.push_back(signs.top());
                    signs.pop();
                    signs.push(simvol);
                }
            }
        }
    }
}

int main()
{
    std::vector <char> number;
    std::string function;
    std::stack<char> signs;
    std::vector <double> exit;
    std::string expression;
    std::cout << "Enter your expression: ";
    std::getline(std::cin, expression);
    size_t expression_size = expression.length();
    for (char h = 0; h < expression_size; h++)
    {
        char simvol;
        simvol = expression[h];
        Exit(exit, signs, function, number, simvol);
        if (h == (expression_size - 1))
        {
            for (char h = 0; h < signs.size(); h++)
            {
                Function_add(function, exit, signs);
                exit.push_back(signs.top());
                signs.pop();
            }
        }
    }
    for (char h : exit)
    {
        std::cout << h << " ";
    }
    std::cout << "\n";
    while (signs.size() != 0)
    {
        std::cout << signs.top() << " ";
        signs.pop();
    }
    std::cout << "\n";
    return 0;
}
